(window.webpackJsonp=window.webpackJsonp||[]).push([[16],{363:function(n,e,t){"use strict";t.r(e);var s=t(42),r=Object(s.a)({},(function(){var n=this,e=n.$createElement,t=n._self._c||e;return t("ContentSlotsDistributor",{attrs:{"slot-key":n.$parent.slotKey}},[t("h1",{attrs:{id:"小程序手册"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#小程序手册"}},[n._v("#")]),n._v(" 小程序手册")]),n._v(" "),t("h2",{attrs:{id:"前言"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#前言"}},[n._v("#")]),n._v(" 前言")]),n._v(" "),t("p",[n._v("小程序手册致力于管理和搜集小程序日常开发组件和方法提取等工作")]),n._v(" "),t("h2",{attrs:{id:"封装wx-request-请求以及对api的管理"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#封装wx-request-请求以及对api的管理"}},[n._v("#")]),n._v(" 封装wx.request()请求以及对API的管理")]),n._v(" "),t("p",[n._v("以下两段代码是对微信小程序的request请求封装和API的管理，以此来提高代码的可维护性和可阅读性以及模块化文件等，同事也提升了开发的效率。")]),n._v(" "),t("h3",{attrs:{id:"request-js"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#request-js"}},[n._v("#")]),n._v(" request.js")]),n._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[n._v("    /**\n * 封装微信的的request\n */\n\n//  项目BASE_URL\nconst WxApiRoot = 'http://localhost:3000';\n\nfunction request(url, data = {}, msg, method) {\n  if (msg.length > 0) {\n    wx.showLoading({\n      title: msg // 数据请求前loading\n    })\n  }\n  return new Promise(function (resolve, reject) {\n    wx.request({\n      url: WxApiRoot + url,\n      data: data,\n      method: method,\n      timeout:8000,\n      header: {\n        'Content-Type': 'application/json',\n        'token': wx.getStorageSync('token')\n      },\n      success: function (res) {\n        setTimeout(()=>{\n          if (msg.length > 0) {\n          wx.hideLoading()\n        }\n        },1000)\n        if (res.data.code == 401) {\n          wxLogin()\n        } else if (res.data.code !=200) {\n          wx.showToast({\n            title: res.data.msg,\n            duration:3000,\n            icon:'none'\n          })\n        }\n        resolve(res.data)\n      },\n      fail: function (err) {\n        if (err.errMsg=='request:fail timeout') {\n          wx.showToast({\n            title: '网络超时，请稍后再试',\n            icon:'none',\n            duration:3000\n          })\n        }\n        wx.setStorageSync('token', '')\n        if (msg.length > 0) {\n          wx.hideLoading()\n        }\n        wx.showToast({\n          title: err.msg,\n          icon:'none',\n          duration:3000\n        })\n        reject(err)\n      }\n    })\n  });\n}\n\n\nfunction wxLogin(isNeed=true) {\n  // 如果不想调用登录后执行 onload onShow 就传 false\n  return new Promise(function (resolve, reject) {\n    wx.login({\n      success: function (res) {\n        if (res.code) {\n          var data = {\n            code: res.code,\n            storeCode: '9003'\n          }\n          post('ma/login/code2Session', data, '').then(res => {\n            \n            wx.setStorageSync('token', res.data.token);\n            wx.setStorageSync('storeInfo',res.data)\n            wx.setStorageSync('isMember',res.data.isMember)\n            let pages = getCurrentPages();\n            let currPage = null;\n            if (pages.length) {\n              currPage = pages[pages.length - 1];\n            }\n            if (isNeed) {\n              currPage.onLoad(currPage.options)\n              currPage.onShow()\n            }\n          \n            resolve(true);\n          })\n        }\n      },\n\n    });\n  });\n}\n\nfunction get(url, params, msg = '加载中...', isParams = \"true\") {\n  return request(url, params, msg, 'GET')\n}\n\nfunction post(url, data, msg = '加载中...', isParams = \"false\") {\n  return request(url, data, msg, 'POST')\n}\nmodule.exports = {\n  get,\n  post,\n  wxLogin\n}\n")])])]),t("p",[n._v("以登录模块为例子")]),n._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[n._v("    var API = require('./request')\n\n    // 获取用户登陆信息\n    export function login(params) {\n        return API.get('/login/cellphone',params)\n    }\n\n")])])]),t("p",[n._v("最后在login.wxjs中导入该login.js模块进行对应业务场景的调用即可")])])}),[],!1,null,null,null);e.default=r.exports}}]);